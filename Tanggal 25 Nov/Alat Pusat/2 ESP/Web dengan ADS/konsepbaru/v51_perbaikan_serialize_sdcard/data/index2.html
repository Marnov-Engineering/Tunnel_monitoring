
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Monitoring Tunnel</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(to right, #f0f4f8, #d9e2ec);
      margin: 0;
      padding: 0px;
      color: #333;
    }

    header {
      background-color: #2f80ed;
      color: white;
      padding: 30px 0;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    h2 { margin: 0; font-size: 24px; }
    main { max-width: 900px; margin: auto; }

    .chart-container {
      margin-top: 30px;
      margin-bottom: 30px;
    }

    .chart-box {
      width: 100%;
      height: 400px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 10px;
    }

    footer {
      text-align: center;
      padding: 15px;
      color: #777;
      font-size: 14px;
    }

    form, .control-section {
      margin: 20px 0;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 1px 5px rgba(0,0,0,0.1);
      justify-content: center;
      align-items: center;
    }

    input, button, select {
      padding: 8px;
      margin: 5px;
      font-size: 14px;
    }

    hr { margin-top: 20px; margin-bottom: 20px; }
  </style>
</head>
<body>
  <header>
    <h2>Monitoring Tunnel</h2>
  </header>

  <main>

    <!-- Form Kontrol dan Kalibrasi -->
    <div style="text-align: center; max-width: 800px; margin: 0 auto;">

      <div class="control-section">
        <p><b>Safety:</b></p>
        <form action="/get">
          <label for="In_Rref">Safety :</label>
          <select name="In_Rref" id="In_Rref">
            <option value="1">Arm</option>
            <option value="0">Disarm</option>
          </select>
          <input type="submit" value="Submit">
        </form>
        <p>Safety = <span id="Safety">-</span></p>
      </div>

    <!-- <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; max-width: 1200px; margin: 0 auto;"> -->
      <div style="
      display: grid; 
      grid-template-columns: repeat(4, 1fr); 
      gap: 20px; 
      max-width: 1200px; 
      margin: 0 auto; 
      justify-content: center; 
      align-items: start; 
      text-align: center;">

      
        <!-- Atas kiri -->
        <div class="control-section">
          <h3>Power Fan 1</h3>
          <form action="/get">
            <input type="number" name="In_Watt_Max1" placeholder="Set Power Fan 1">
            <input type="submit" value="Submit">
          </form>
          <p>Power 1 = <span id="Watt1">0</span> WATT</p>
          <p>Kecepatan 1 = <span id="Kecepatan1">0</span> %</p>
        </div>

        <!-- Atas kanan -->
        <div class="control-section">
          <h3>Power Fan 2</h3>
          <form action="/get">
            <input type="number" name="In_Watt_Max2" placeholder="Set Power Fan 2">
            <input type="submit" value="Submit">
          </form>
          <p>Power 2 = <span id="Watt2">0</span> WATT</p>
          <p>Kecepatan 2 = <span id="Kecepatan2">0</span> %</p>
        </div>

        <!-- Bawah kiri -->
        <div class="control-section">
          <h3>Power Fan 3</h3>
          <form action="/get">
            <input type="number" name="In_Watt_Max3" placeholder="Set Power Fan 3">
            <input type="submit" value="Submit">
          </form>
          <p>Power 3 = <span id="Watt3">0</span> WATT</p>
          <p>Kecepatan 3 = <span id="Kecepatan3">0</span> %</p>
        </div>

        <!-- Bawah kanan -->
        <div class="control-section">
          <h3>Power Fan 4</h3>
          <form action="/get">
            <input type="number" name="In_Watt_Max4" placeholder="Set Power Fan 4">
            <input type="submit" value="Submit">
          </form>
          <p>Power 4 = <span id="Watt4">0</span> WATT</p>
          <p>Kecepatan 4 = <span id="Kecepatan4">0</span> %</p>
        </div>
      </div>


      <!-- <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; max-width: 1200px; margin: 0 auto;"> -->
        <div style="
        display: grid; 
        grid-template-columns: repeat(4, 1fr); 
        gap: 20px; 
        max-width: 1200px; 
        margin: 0 auto; 
        justify-content: center; 
        align-items: start; 
        text-align: center;">

      <div class="control-section">
        <p><b>Arus WCS1700 1:</b></p>
        <p>Arus = <span id="Arus1">0</span> A</p>
        <p>Input Kalibrasi Sensor WCS1700 (y = mx + b)</p>
        <form action="/get">
          <input type="number" name="In_CalM_Wcs1" step="0.00001" placeholder="Input M">
          <input type="submit" value="Submit">
        </form>
        <form action="/get">
          <input type="number" name="In_CalB_Wcs1" step="0.00001" placeholder="Input B">
          <input type="submit" value="Submit">
        </form>
        <p>Nilai M = <span id="CalM_Wcs1">1.00000</span>, Nilai B = <span id="CalB_Wcs1">0.00000</span></p>
      </div>

      <div class="control-section">
        <p><b>Arus WCS1700 2:</b></p>
        <p>Arus = <span id="Arus2">0</span> A</p>
        <p>Input Kalibrasi Sensor WCS1700 (y = mx + b)</p>
        <form action="/get">
          <input type="number" name="In_CalM_Wcs2" step="0.00001" placeholder="Input M">
          <input type="submit" value="Submit">
        </form>
        <form action="/get">
          <input type="number" name="In_CalB_Wcs2" step="0.00001" placeholder="Input B">
          <input type="submit" value="Submit">
        </form>
        <p>Nilai M = <span id="CalM_Wcs2">1.00000</span>, Nilai B = <span id="CalB_Wcs2">0.00000</span></p>
      </div>

      <div class="control-section">
        <p><b>Arus WCS1700 3:</b></p>
        <p>Arus = <span id="Arus3">0</span> A</p>
        <p>Input Kalibrasi Sensor WCS1700 (y = mx + b)</p>
        <form action="/get">
          <input type="number" name="In_CalM_Wcs3" step="0.00001" placeholder="Input M">
          <input type="submit" value="Submit">
        </form>
        <form action="/get">
          <input type="number" name="In_CalB_Wcs3" step="0.00001" placeholder="Input B">
          <input type="submit" value="Submit">
        </form>
        <p>Nilai M = <span id="CalM_Wcs3">1.00000</span>, Nilai B = <span id="CalB_Wcs3">0.00000</span></p>
      </div>

      <div class="control-section">
        <p><b>Arus WCS1700 4:</b></p>
        <p>Arus = <span id="Arus4">0</span> A</p>
        <p>Input Kalibrasi Sensor WCS1700 (y = mx + b)</p>
        <form action="/get">
          <input type="number" name="In_CalM_Wcs4" step="0.00001" placeholder="Input M">
          <input type="submit" value="Submit">
        </form>
        <form action="/get">
          <input type="number" name="In_CalB_Wcs4" step="0.00001" placeholder="Input B">
          <input type="submit" value="Submit">
        </form>
        <p>Nilai M = <span id="CalM_Wcs4">1.00000</span>, Nilai B = <span id="CalB_Wcs4">0.00000</span></p>
      </div>


    </div>
    <div style="
  display: grid; 
  grid-template-columns: repeat(2, 1fr); 
  gap: 20px; 
  max-width: 1200px; 
  margin: 0 auto; 
  justify-content: center; 
  align-items: start; 
  text-align: center;">

      <div class="control-section">
        <p><b>Menu Kontrol Sistem</b></p>
        <button onclick="window.location.href='/controling'">Ke Halaman Kontrol</button>
      </div>

      <div class="control-section">
        <p><b>Setting MAC Address</b></p>
        <button onclick="window.location.href='/MAC'">Ke Settingan MAC Address</button>
      </div>
  
      
      <div class="control-section">

        <p><b>OTA</b></p>
        <button onclick="updateServer()">Update Server</button>
      </div>
    </div>
  </main>

  <footer>
    &copy; 2025 | Sistem Monitoring Tunnel ESP32
  </footer>

  <!-- JavaScript -->
  <script>

    setInterval(function () {
      const xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          const data = this.responseText.split(',');
          document.getElementById("Safety").innerHTML = (data[0] === "1") ? "ON" : "OFF";

          document.getElementById("Watt1").innerHTML = data[1];
          document.getElementById("Watt2").innerHTML = data[2];
          document.getElementById("Watt3").innerHTML = data[3];
          document.getElementById("Watt4").innerHTML = data[4];

          document.getElementById("Kecepatan1").innerHTML = data[5];
          document.getElementById("Kecepatan2").innerHTML = data[6];
          document.getElementById("Kecepatan3").innerHTML = data[7];
          document.getElementById("Kecepatan4").innerHTML = data[8];

          document.getElementById("CalM_Wcs1").innerHTML = parseFloat(data[9]).toFixed(5);
          document.getElementById("CalB_Wcs1").innerHTML = parseFloat(data[13]).toFixed(5);

          document.getElementById("CalM_Wcs2").innerHTML = parseFloat(data[10]).toFixed(5);
          document.getElementById("CalB_Wcs2").innerHTML = parseFloat(data[14]).toFixed(5);

          document.getElementById("CalM_Wcs3").innerHTML = parseFloat(data[11]).toFixed(5);
          document.getElementById("CalB_Wcs3").innerHTML = parseFloat(data[15]).toFixed(5);

          document.getElementById("CalM_Wcs4").innerHTML = parseFloat(data[12]).toFixed(5);
          document.getElementById("CalB_Wcs4").innerHTML = parseFloat(data[16]).toFixed(5);

          document.getElementById("Arus1").innerHTML = data[17];
          document.getElementById("Arus2").innerHTML = data[18];
          document.getElementById("Arus3").innerHTML = data[19];
          document.getElementById("Arus4").innerHTML = data[20];

        }
      };
      xhttp.open("GET", "/dataSet", true);
      xhttp.send();
    }, 1000);

    function updateServer() {
      const xhttp = new XMLHttpRequest();
      xhttp.open("GET", "/updateServer", true);
      xhttp.send();
    }
  </script>
</body>
</html>
